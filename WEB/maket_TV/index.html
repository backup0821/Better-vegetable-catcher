<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¾²ç”¢å“äº¤æ˜“è³‡æ–™åˆ†æç³»çµ± - é›»è¦–çœ‹æ¿</title>
    <link rel="stylesheet" href="styles/tv-display.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- å…ˆè¼‰å…¥ YouTube API -->
    <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
    <div class="tv-container">
        <!-- é é¦– -->
        <header class="tv-header">
            <div class="tv-title">è¾²ç”¢å“äº¤æ˜“è³‡æ–™åˆ†æç³»çµ± - <span id="marketName">XXå¸‚å ´</span></div>
            <div class="tv-subtitle">è³‡æ–™ä¾†æºï¼šè¾²æ¥­éƒ¨è³‡æ–™é–‹æ”¾å¹³å°ã€€è£½ä½œå–®ä½ï¼šé¹¿ä¸­å‰µå®¢</div>
        </header>
        <div class="tv-main-layout">
            <!-- å·¦å´å€å¡Š -->
            <div class="tv-left-panel">
                <div class="tv-clock-card">
                    <div class="tv-clock-icon">ğŸ•’</div>
                    <div class="tv-clock-datetime">
                        <div id="currentDate" class="tv-date">2025/5/9</div>
                        <div id="currentTime" class="tv-time">20:00:00</div>
                    </div>
                </div>
                <div class="tv-notify-card">
                    <div class="tv-notify-title">ğŸ””é€šçŸ¥</div>
                    <div class="tv-notify-list" id="notificationList">
                        <!-- é€šçŸ¥å‹•æ…‹ç”¢ç”Ÿï¼ˆæ©˜è‰²å¡ç‰‡ç”± JS ç”¢ç”Ÿï¼‰ -->
                    </div>
                </div>
            </div>
            <!-- ä¸­å¤®ä¸»è¦é¡¯ç¤ºå€ -->
            <div class="tv-center-panel">
                <div class="tv-main-display" id="mainDisplay">
                </div>
            </div>
            <!-- å³å´å€å¡Š -->
            <div class="tv-right-panel">
                <div class="tv-price-card">
                    <div class="tv-price-label">ä¸Šåƒ¹</div>
                    <div class="tv-price-value" id="priceHigh">--</div>
                </div>
                <div class="tv-price-card">
                    <div class="tv-price-label">ä¸‹åƒ¹</div>
                    <div class="tv-price-value" id="priceLow">--</div>
                </div>
                <div class="video-container">
                    <div id="player"></div>
                </div>
            </div>
        </div>
        <!-- ä¸‹æ–¹è³‡è¨Šåˆ— -->
        <div class="tv-bottom-bar">
            <div class="tv-bottom-item">
                <span class="tv-bottom-icon">ğŸ…</span>
                <span class="tv-bottom-label">ä½œç‰©åç¨±</span>
                <span class="tv-bottom-value" id="cropName">--</span>
            </div>
            <div class="tv-bottom-item">
                <span class="tv-bottom-icon">ğŸ“Š</span>
                <span class="tv-bottom-label">äº¤æ˜“é‡</span>
                <span class="tv-bottom-value" id="tradeVolume">--</span>
            </div>
            <div class="tv-bottom-item">
                <span class="tv-bottom-icon">ğŸ“ˆ</span>
                <span class="tv-bottom-label">å¹³å‡åƒ¹</span>
                <span class="tv-bottom-value" id="avgPrice">--</span>
            </div>
        </div>
    </div>
    <script src="js/tv-display.js"></script>
    <script>
        let player;
        let currentVideoIndex = 0;
        let videos = [];

        // ç•¶ YouTube API æº–å‚™å¥½æ™‚
        function onYouTubeIframeAPIReady() {
            // å…ˆç²å–å½±ç‰‡åˆ—è¡¨
            fetch('https://data.moa.gov.tw/Service/OpenData/Agriculturalcoa_videoRss.aspx')
                .then(response => response.json())
                .then(data => {
                    videos = data.map(item => {
                        // å¾ YouTube URL æå–å½±ç‰‡ ID
                        const videoId = item.link.split('/').pop();
                        return videoId;
                    });
                    
                    // åˆå§‹åŒ–æ’­æ”¾å™¨
                    initPlayer();
                })
                .catch(error => {
                    console.error('ç²å–å½±ç‰‡åˆ—è¡¨å¤±æ•—:', error);
                    // å¦‚æœç²å–å¤±æ•—ï¼Œä½¿ç”¨é è¨­å½±ç‰‡
                    videos = ['dQw4w9WgXcQ']; // é è¨­å½±ç‰‡ID
                    initPlayer();
                });
        }

        function initPlayer() {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: videos[currentVideoIndex],
                playerVars: {
                    'autoplay': 1,
                    'controls': 0,
                    'rel': 0,
                    'showinfo': 0,
                    'mute': 1,  // è‡ªå‹•æ’­æ”¾éœ€è¦éœéŸ³
                    'loop': 1,  // å¾ªç’°æ’­æ”¾
                    'playsinline': 1,  // åœ¨ iOS ä¸Šå…§åµŒæ’­æ”¾
                    'enablejsapi': 1,  // å•Ÿç”¨ JavaScript API
                    'origin': window.location.origin,  // è¨­å®šä¾†æº
                    'widget_referrer': window.location.href  // è¨­å®šå¼•ç”¨ä¾†æº
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
        }

        function onPlayerReady(event) {
            event.target.playVideo();
        }

        function onPlayerStateChange(event) {
            // ç•¶å½±ç‰‡çµæŸæ™‚
            if (event.data == YT.PlayerState.ENDED) {
                // æ’­æ”¾ä¸‹ä¸€å€‹å½±ç‰‡
                currentVideoIndex = (currentVideoIndex + 1) % videos.length;
                player.loadVideoById(videos[currentVideoIndex]);
            }
        }

        function onPlayerError(event) {
            console.error('æ’­æ”¾å™¨éŒ¯èª¤:', event.data);
            // å¦‚æœç™¼ç”ŸéŒ¯èª¤ï¼Œå˜—è©¦æ’­æ”¾ä¸‹ä¸€å€‹å½±ç‰‡
            currentVideoIndex = (currentVideoIndex + 1) % videos.length;
            player.loadVideoById(videos[currentVideoIndex]);
        }
    </script>
</body>
</html>
